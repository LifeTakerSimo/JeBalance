@page
@model IndexModel
@{
    ViewData["Title"] = "Page d'accueil";
}

<div class="container mt-5">
    <div class="text-center mb-5">
        <img src="/images/Logo.png" alt="JB Logo" class="mb-3" style="max-height: 100px;"> <!-- Adjust the max-height as needed -->

        <h1 class="display-4">Bienvenue sur JeBalance</h1>
        <p class="lead">Votre plateforme dédiée à la dénonciation citoyenne.</p>
    </div>
    <div id="responseMessage" class="alert" style="display: none;"></div>
    <form method="post" asp-page-handler="CreateDenunciation" class="needs-validation" novalidate>
        <div class="row mb-4">
            <div class="col">
                <h2>Informations sur l'Informateur</h2>
                <!-- Informateur First Name -->
                <div class="form-group">
                    <label for="InformateurFirstName">Prénom :</label>
                    <input type="text" class="form-control" id="InformateurFirstName" name="InformateurFirstName" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <!-- Informateur Last Name -->
                <div class="form-group">
                    <label for="InformateurLastName">Nom :</label>
                    <input type="text" class="form-control" id="InformateurLastName" name="InformateurLastName" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <!-- Informateur Address -->
                <div class="form-group">
                    <label for="InformateurStreetNumber">Numéro de rue :</label>
                    <input type="text" class="form-control" id="InformateurStreetNumber" name="InformateurStreetNumber" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <div class="form-group">
                    <label for="InformateurStreetName">Nom de rue :</label>
                    <input type="text" class="form-control" id="InformateurStreetName" name="InformateurStreetName" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <div class="form-group">
                    <label for="InformateurPostalCode">Code Postal :</label>
                    <input type="text" class="form-control" id="InformateurPostalCode" name="InformateurPostalCode" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <div class="form-group">
                    <label for="InformateurCityName">Ville :</label>
                    <input type="text" class="form-control" id="InformateurCityName" name="InformateurCityName" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <!-- Informateur Email -->
                <div class="form-group">
                    <label for="InformateurEmail">Email :</label>
                    <input type="email" class="form-control" id="InformateurEmail" name="InformateurEmail" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <div class="form-group">
                    <label for="InformateurUsername">Username :</label>
                    <input type="text" class="form-control" id="InformateurUsername" name="InformateurUsername" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>

            </div>
            <div class="col">
                <h2>Informations sur le Suspect</h2>
                <!-- Suspect First Name -->
                <div class="form-group">
                    <label for="SuspectFirstName">Prénom :</label>
                    <input type="text" class="form-control" id="SuspectFirstName" name="SuspectFirstName" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <!-- Suspect Last Name -->
                <div class="form-group">
                    <label for="SuspectLastName">Nom :</label>
                    <input type="text" class="form-control" id="SuspectLastName" name="SuspectLastName" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <!-- Suspect Address -->
                <div class="form-group">
                    <label for="SuspectStreetNumber">Numéro de rue :</label>
                    <input type="text" class="form-control" id="SuspectStreetNumber" name="SuspectStreetNumber" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <div class="form-group">
                    <label for="SuspectStreetName">Nom de rue :</label>
                    <input type="text" class="form-control" id="SuspectStreetName" name="SuspectStreetName" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <div class="form-group">
                    <label for="SuspectPostalCode">Code Postal :</label>
                    <input type="text" class="form-control" id="SuspectPostalCode" name="SuspectPostalCode" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <div class="form-group">
                    <label for="SuspectCityName">Ville :</label>
                    <input type="text" class="form-control" id="SuspectCityName" name="SuspectCityName" required>
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
                <!-- Suspect Email -->
                <div class="form-group">
                    <label for="SuspectEmail">Email :</label>
                    <input type="email" class="form-control" id="SuspectEmail" name="SuspectEmail">
                    <div class="invalid-feedback">Ce champ est obligatoire.</div>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <h2>Informations sur la dénonciation</h2>
            <!-- Country of Evasion -->
            <div class="form-group">
                <label for="CountryEvasion">Pays d'évasion :</label>
                <input type="text" class="form-control" id="CountryEvasion" name="CountryEvasion" required>
                <div class="invalid-feedback">Ce champ est obligatoire.</div>
            </div>
            <!-- Type of Offense -->
            <div class="form-group">
                <label for="TypeOfOffense">Type d'infraction :</label>
                <select class="form-control" id="TypeOfOffense" name="TypeOfOffense" required>
                    <option value="DissimulationDeRevenus">Dissimulation de Revenus</option>
                    <option value="EvasionFiscale">Évasion Fiscale</option>
                </select>
                <div class="invalid-feedback">Veuillez sélectionner une option.</div>
            </div>
        </div>

        <div class="text-center">
            <button type="submit" class="btn btn-primary">Soumettre la dénonciation</button>
        </div>
    </form>
</div>

<script>document.addEventListener("DOMContentLoaded", function () {
        var form = document.querySelector('form.needs-validation');

    form.addEventListener('submit', function (event) {
        event.preventDefault();
        if (!form.checkValidity()) {
            event.stopPropagation();
        } else {
            var formData = new FormData(form);
            var denunciation = {
                informant: {
                    firstName: formData.get('InformateurFirstName'),
                    lastName: formData.get('InformateurLastName'),
                    streetNumber: formData.get('InformateurStreetNumber'),
                    streetName: formData.get('InformateurStreetName'),
                    postalCode: formData.get('InformateurPostalCode'),
                    cityName: formData.get('InformateurCityName'),
                    userName: formData.get('InformateurUsername'),
                    email: formData.get('InformateurEmail')
                },
                suspect: {
                    firstName: formData.get('SuspectFirstName'),
                    lastName: formData.get('SuspectLastName'),
                    streetNumber: formData.get('SuspectStreetNumber'),
                    streetName: formData.get('SuspectStreetName'),
                    postalCode: formData.get('SuspectPostalCode'),
                    cityName: formData.get('SuspectCityName'),
                    email: formData.get('SuspectEmail')
                },
                offense: formData.get('TypeOfOffense'),
                evasionCountry: formData.get('CountryEvasion')
            };

            var json = JSON.stringify(denunciation);

            fetch(`${apiBaseUrl}/api/Denonciation/create_denonciation`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: json
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    var messageElement = document.getElementById('responseMessage');
                    messageElement.textContent = 'La dénonciation a été créée avec succès. Votre identifiant de référence est :' + data.denonciationId;
                    messageElement.className = 'alert alert-success';
                    messageElement.style.display = 'block';
                })
                .catch(error => {
                    console.error('Error:', error);
                    var messageElement = document.getElementById('responseMessage');
                    messageElement.textContent = 'Error: ' + error.message;
                    messageElement.className = 'alert alert-danger'; 
                    messageElement.style.display = 'block'; 
                });

        }
        form.classList.add('was-validated');
    });

    });</script>

<script type="text/javascript">
    var apiBaseUrl = '@Model.ApiBaseUrl';
</script>
